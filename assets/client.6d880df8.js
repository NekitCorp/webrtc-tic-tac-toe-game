import{R as x,S as A,i as I,s as P,L as q,c as C,m as k,t as g,a as h,d as y,b as v,G,e as M,f as w,g as N,h as O,j as b,C as B,k as _,l as S,n as W,p as m,q as f,r as j,u as $,v as F,w as U,D as z,A as H,B as J}from"./global.2a6201d3.js";class K extends x{connectToDataChannel(e){this.setRemoteDescription(e),this.peerConnection.createAnswer().then(t=>{console.log("[CREATE ANSWER]",t),this.peerConnection.setLocalDescription(t).then(()=>{console.log("[SET LOCAL DESCRIPTION]")},s=>{console.error("setLocalDescription failed",s)})},t=>{console.error("createAnswer failed",t)})}}function Q(c){let e,t,s,n,r;return{c(){e=_("div"),t=_("h1"),t.textContent="Wrong connection state",s=S(),n=_("p"),r=W(c[0]),m(t,"class","dialog-text"),m(n,"class","dialog-text"),m(e,"class","standard-dialog center")},m(a,l){w(a,e,l),f(e,t),f(e,s),f(e,n),f(n,r)},p(a,l){l&1&&j(r,a[0])},i:$,o:$,d(a){a&&b(e)}}}function V(c){let e,t,s,n,r;return t=new F({props:{state:c[4]}}),t.$on("send",c[7]),n=new U({props:{messages:c[2]}}),n.$on("send",c[8]),{c(){e=_("div"),C(t.$$.fragment),s=S(),C(n.$$.fragment),m(e,"class","game animate__animated animate__backInLeft svelte-1bqqn1k")},m(a,l){w(a,e,l),k(t,e,null),f(e,s),k(n,e,null),r=!0},p(a,l){const o={};l&4&&(o.messages=a[2]),n.$set(o)},i(a){r||(g(t.$$.fragment,a),g(n.$$.fragment,a),r=!0)},o(a){h(t.$$.fragment,a),h(n.$$.fragment,a),r=!1},d(a){a&&b(e),y(t),y(n)}}}function X(c){let e,t,s,n,r,a,l;return{c(){e=_("div"),t=_("h1"),t.textContent="Send your local offer to player #1",s=S(),n=_("textarea"),m(t,"class","dialog-text"),m(n,"rows",10),z(n,"width","100%"),n.value=r=window.btoa(c[1]),m(e,"class","standard-dialog center animate__animated animate__backInLeft")},m(o,i){w(o,e,i),f(e,t),f(e,s),f(e,n),a||(l=H(J.call(null,n)),a=!0)},p(o,i){i&2&&r!==(r=window.btoa(o[1]))&&(n.value=r)},i:$,o:$,d(o){o&&b(e),a=!1,l()}}}function Y(c){let e,t,s,n;const r=[X,V,Q],a=[];function l(o,i){return o[0]==="connecting"?0:o[0]==="connected"?1:2}return e=l(c),t=a[e]=r[e](c),{c(){t.c(),s=M()},m(o,i){a[e].m(o,i),w(o,s,i),n=!0},p(o,i){let d=e;e=l(o),e===d?a[e].p(o,i):(N(),h(a[d],1,1,()=>{a[d]=null}),O(),t=a[e],t?t.p(o,i):(t=a[e]=r[e](o),t.c()),g(t,1),t.m(s.parentNode,s))},i(o){n||(g(t),n=!0)},o(o){h(t),n=!1},d(o){a[e].d(o),o&&b(s)}}}function Z(c){let e,t;return e=new q({props:{$$slots:{default:[Y]},$$scope:{ctx:c}}}),{c(){C(e.$$.fragment)},m(s,n){k(e,s,n),t=!0},p(s,[n]){const r={};n&8199&&(r.$$scope={dirty:n,ctx:s}),e.$set(r)},i(s){t||(g(e.$$.fragment,s),t=!0)},o(s){h(e.$$.fragment,s),t=!1},d(s){y(e,s)}}}function ee(c,e,t){let s,n,r;const a=new B,{messages:l}=a;v(c,l,u=>t(2,r=u));const o=new G(2),{state:i}=o,d=new K(a,o),{localDescription:D,connectionState:L}=d;v(c,D,u=>t(1,n=u)),v(c,L,u=>t(0,s=u));const E=new URLSearchParams(window.location.search);d.connectToDataChannel(window.atob(E.get("offer")));function R(u){if(u.detail){const p=u.detail;o.send(p),d.sendMessage({type:"game",event:p})}}function T(u){if(u.detail){const p=u.detail;a.addMessage(p),d.sendMessage({type:"chat",text:p})}}return[s,n,r,l,i,D,L,R,T]}class te extends A{constructor(e){super(),I(this,e,ee,Z,P,{})}}new te({target:document.getElementById("app")});
